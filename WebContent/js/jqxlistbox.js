/*
Copyright (c) 2012 jqWidgets.
http://jqwidgets.com/license/
*/

(function(a){a.jqx.jqxWidget("jqxListBox","",{});a.extend(a.jqx._jqxListBox.prototype,{defineInstance:function(){this.disabled=false;this.width=null;this.height=null;this.items=new Array();this.multiple=false;this.selectedIndex=-1;this.selectedIndexes=new Array();this.source=null;this.scrollBarSize=15;this.enableHover=true;this.enableSelection=true;this.visualItems=new Array();this.groups=new Array();this.equalItemsWidth=true;this.itemHeight=-1;this.visibleItems=new Array();this.emptyGroupText="Group";this.checkboxes=false;this.hasThreeStates=false;this.autoHeight=false;this.roundedcorners=true;this.touchMode="auto";this.events=["select","unselect","change","checkchange",]},createInstance:function(c){var b=this;this.host.addClass(this.toThemeProperty("jqx-listbox"));this.host.addClass(this.toThemeProperty("jqx-reset"));this.host.addClass(this.toThemeProperty("jqx-rc-all"));if(this.width!=null&&this.width.toString().indexOf("%")!=-1){this.host.width(this.width)}if(this.height!=null&&this.height.toString().indexOf("%")!=-1){this.host.height(this.height)}if(this.width!=null&&this.width.toString().indexOf("px")!=-1){this.host.width(this.width)}else{if(this.width!=undefined&&!isNaN(this.width)){this.host.width(this.width)}}if(this.height!=null&&this.height.toString().indexOf("px")!=-1){this.host.height(this.height)}else{if(this.height!=undefined&&!isNaN(this.height)){this.host.height(this.height)}}var d=a("<div tabIndex=0 style='-webkit-appearance: none; background: transparent; outline: none; width:100%; height: 100%; align:left; border: 0px; padding: 0px; margin: 0px; left: 0px; top: 0px; valign:top; position: relative;'><div id='listBoxWrapper' tabIndex=1 style='-webkit-appearance: none; border: none; background: transparent; outline: none; width:100%; height: 100%; padding: 0px; margin: 0px; align:left; left: 0px; top: 0px; valign:top; position: relative;'><div id='listBoxContent' tabIndex=2 style='-webkit-appearance: none; border: none; background: transparent; outline: none; border: none; padding: 0px; overflow: hidden; margin: 0px; align:left; valign:top; left: 0px; top: 0px; position: absolute;'/><div id='verticalScrollBar"+this.element.id+"' style='align:left; valign:top; left: 0px; top: 0px; position: absolute;'/><div id='horizontalScrollBar"+this.element.id+"' style='align:left; valign:top; left: 0px; top: 0px; position: absolute;'/><div id='bottomRight' style='align:left; valign:top; left: 0px; top: 0px; border: none; position: absolute;'/></div></div>");this.host.css("tabIndex",1);this.host.append(d);var f=this.host.find("#verticalScrollBar"+this.element.id);if(!f.jqxScrollBar){alert("jqxscrollbar.js is not loaded.");return}if(this.touchMode==true){a.jqx.mobile.setMobileSimulator(this.element)}this.vScrollBar=f.jqxScrollBar({vertical:true,theme:this.theme,touchMode:this.touchMode,largestep:parseInt(this.host.height())/2});var e=this.host.find("#horizontalScrollBar"+this.element.id);this.hScrollBar=e.jqxScrollBar({vertical:false,touchMode:this.touchMode,theme:this.theme});this.content=this.host.find("#listBoxContent");this.bottomRight=this.host.find("#bottomRight").addClass(this.toThemeProperty("jqx-listbox-bottomright"));this.vScrollBar.css("visibility","visible");this.hScrollBar.css("visibility","visible");this.vScrollInstance=a.data(this.vScrollBar[0],"jqxScrollBar").instance;this.hScrollInstance=a.data(this.hScrollBar[0],"jqxScrollBar").instance;if(this.isTouchDevice()){a.jqx.mobile.touchScroll(this.content,b.vScrollInstance.max,function(i,h){if(b.vScrollBar.css("visibility")=="visible"){var g=b.vScrollInstance.value;b.vScrollInstance.setPosition(g+h)}if(b.hScrollBar.css("visibility")=="visible"){var g=b.hScrollInstance.value;b.hScrollInstance.setPosition(g+i)}})}this.host.addClass("jqx-disableselect")},isTouchDevice:function(){var b=a.jqx.mobile.isTouchDevice();if(this.touchMode==true){b=true}else{if(this.touchMode==false){b=false}}return b},beginUpdateLayout:function(){this.updating=true},resumeUpdateLayout:function(){this.updating=false;this.vScrollInstance.value=0;this._render(false)},propertyChangedHandler:function(b,c,e,d){if(this.isInitialized==undefined||this.isInitialized==false){return}if(c=="source"||c=="scrollBarSize"||c=="equalItemsWidth"||c=="checkboxes"){b.clearSelection();b.refresh();b.selectIndex(0)}if(!this.updating){if(c=="width"||c=="height"){setTimeout(function(){b.vScrollInstance.value=0;if(c=="width"){if(e!=d){b.host.width(d);b._updatescrollbars();b._renderItems()}}else{if(e!=d){b.host.height(d);if(b.items){if(b.items.length>0&&b.virtualItemsCount*b.items[0].height<d){b._render(false)}else{b._updatescrollbars();b._renderItems()}}}}},1)}}if(c=="theme"){b.jqxScrollBar({theme:b.theme});b.jqxScrollBar({theme:b.theme})}if(c=="selectedIndex"){b.selectIndex(d,true)}if(c=="autoHeight"){b.refresh()}},loadFromSelect:function(i){if(i==null){return}var c="#"+i;var f=a(c);if(f.length>0){var e=f.find("option");var b=f.find("optgroup");var d=0;var h=-1;var g=new Array();a.each(e,function(){var l=b.find(this).length>0;var n=null;if(this.text!=this.value&&this.label==null){this.label=this.text}var m={disabled:this.disabled,value:this.value,label:this.label,title:this.title,originalItem:this};var k=a.browser.msie&&a.browser.version<8;if(k){if(m.value==""&&this.text!=null&&this.text.length>0){m.value=this.text}}if(l){n=b.find(this).parent()[0].label;m.group=n}if(this.selected){h=d}g[d]=m;d++});this.source=g;this.fromSelect=true;this.clearSelection();this.selectedIndex=h;this.refresh()}},refresh:function(){var b=this.host.find("#verticalScrollBar"+this.element.id);if(!b.jqxScrollBar){return}this.visibleItems=new Array();this.items=this.loadItems(this.source);this._render()},_render:function(c){this._addItems();this._renderItems();var b=a.data(this.vScrollBar[0],"jqxScrollBar").instance;b.setPosition(0);if(c==undefined||c){if(this.items!=undefined&&this.items!=null){if(this.selectedIndex>=0&&this.selectedIndex<this.items.length){this.selectIndex(this.selectedIndex);this.ensureVisible(this.selectedIndex)}}}},_createID:function(){var b=Math.random()+"";b=b.replace(".","");b="99"+b;b=b/1;while(this.items[b]){b=Math.random()+"";b=b.replace(".","");b=b/1}return"listitem"+b},_hitTest:function(c,e){var d=parseInt(this.vScrollInstance.value);var b=this._searchFirstVisibleIndex(e+d,this.renderedVisibleItems);if(this.renderedVisibleItems[b]!=undefined&&this.renderedVisibleItems[b].isGroup){return null}b=this._searchFirstVisibleIndex(e+d);return this.visibleItems[b];return null},_searchFirstVisibleIndex:function(e,f){if(e==undefined){e=parseInt(this.vScrollInstance.value)}var c=0;if(f==undefined||f==null){f=this.visibleItems}var b=f.length;while(c<=b){mid=parseInt((c+b)/2);var d=f[mid];if(d==undefined){break}if(d.initialTop>e&&d.initialTop+d.height>e){b=mid-1}else{if(d.initialTop<e&&d.initialTop+d.height<e){c=mid+1}else{return mid;break}}}return 0},_renderItems:function(){if(this.items==undefined||this.items.length==0){return}var n=this.vScrollInstance;var w=this.hScrollInstance;var t=parseInt(n.value);var f=parseInt(w.value);var E=this.items.length;var x=parseInt(this.content.width())+parseInt(w.max);var d=parseInt(this.vScrollBar.outerWidth());if(this.vScrollBar.css("visibility")!="visible"){d=0}if(this.hScrollBar.css("visibility")!="visible"){x=parseInt(this.content.width())}var h=this._getVirtualItemsCount();var G=new Array();var m=0;var l=this.host.outerHeight();var C=0;var i=0;var b=0;if(n.value==0||this.visibleItems.length==0){for(indx=0;indx<this.items.length;indx++){var F=this.items[indx];if(F.visible){F.top=-t;F.initialTop=-t;if(!F.isGroup&&F.visible){this.visibleItems[i++]=F;F.visibleIndex=i-1}this.renderedVisibleItems[b++]=F;F.left=-f;var k=F.top+F.height;if(k>=0&&F.top-F.height<=l){G[m++]={index:indx,item:F}}t-=F.height}}}var c=t>0?this._searchFirstVisibleIndex(this.vScrollInstance.value,this.renderedVisibleItems):0;var z=0;m=0;var p=this.vScrollInstance.value;var A=0;while(z<100+l){var F=this.renderedVisibleItems[c];if(F==undefined){break}if(F.visible){F.left=-f;var k=F.top+F.height-p;if(k>=0&&F.initialTop-p-F.height<=2*l){G[m++]={index:c,item:F}}}c++;if(F.visible){z+=F.initialTop-p+F.height-z}A++;if(A>this.items.length-1){break}}var I=this.toThemeProperty("jqx-listitem-state-normal");var s=this.toThemeProperty("jqx-listitem-state-group");var v=this.toThemeProperty("jqx-listitem-state-disabled");var H=0;for(indx=0;indx<this.visualItems.length;indx++){var D=this.visualItems[indx];var B=function(){var y=D.find("#spanElement");y.css({visibility:"hidden"});y.removeClass();if(this.checkboxes&&this.host.jqxCheckBox){var J=D.find("chkbox");J.css({visibility:"hidden"})}};if(indx<G.length){var F=G[indx].item;if(F.initialTop-p>=l){B();continue}var u=D.find("#spanElement");if(u.length==0){continue}u.removeClass();u.css({display:"block",visibility:"visible"});if(!F.isGroup&&!this.selectedIndexes[F.index]>=0){u.addClass(I)}else{u.addClass(s)}if(F.disabled||this.disabled){u.addClass(v)}if(this.roundedcorners){u.addClass(this.toThemeProperty("jqx-rc-all"))}if(F.html!=null&&F.html.toString().length>0){u[0].innerHTML=F.html}else{if(F.label!=null||F.value!=null){if(F.label!=null){if(u[0].innerHTML!==F.label){u[0].innerHTML=F.label}}else{if(u[0].innerHTML!==F.value){u[0].innerHTML=F.value}}}}D[0].style.left=F.left+"px";D[0].style.top=F.initialTop-p+"px";F.element=u[0];a.data(u[0],"item",F);if(F.title){u[0].title=F.title}if(this.equalItemsWidth&&!F.isGroup){if(C==0){var e=parseInt(x);var q=parseInt(u.outerWidth())-parseInt(u.width());e-=q;var o=1;if(o!=null){o=parseInt(o)}else{o=0}e-=2*o;C=e;if(this.checkboxes&&this.host.jqxCheckBox){C-=18}}u.width(C);F.width=C}if(this.checkboxes&&this.host.jqxCheckBox&&!F.isGroup){if(H==0){H=(parseInt(D.outerHeight(true))-16)/2;H++}var r=a(D.children()[0]);r[0].item=F;u.css({left:"18px"});r.css("top",H+"px");r.css({display:"block",visibility:"visible"});var g=r.jqxCheckBox("checked");if(g!=F.checked){r.jqxCheckBox({checked:F.checked,disabled:F.disabled})}}if(this.selectedIndexes[F.visibleIndex]>=0&&!F.disabled){u.addClass(this.toThemeProperty("jqx-listitem-state-selected"))}}else{B()}}},_calculateVirtualSize:function(){var d=0;var i=2;var g=0;var f=a("<span></span>");var e=0;var c=this.host.outerHeight();a(document.body).append(f);for(g=0;g<this.items.length;g++){var k=this.items[g];if(k.isGroup&&(k.label==""&&k.html=="")){continue}if(!k.visible){continue}if(this.itemHeight>-1){k.height=this.itemHeight;k.width=this.content.width();i+=this.itemHeight}else{if(!k.isGroup){f.addClass(this.toThemeProperty("jqx-listitem-state-normal jqx-rc-all"))}else{f.addClass(this.toThemeProperty("jqx-listitem-state-group jqx-rc-all"))}if(this.equalItemsWidth){f.css("float","left")}if(k.html!=null&&k.html.toString().length>0){f.html(k.html)}else{if(k.label!=null||k.value!=null){if(k.label!=null){f.text(k.label)}else{f.text(k.value)}}}var b=f.outerHeight();var h=f.outerWidth();k.height=b;k.width=h;i+=b;d=Math.max(d,h)}if(i<=c){e++}}if(e<10){e=10}f.remove();return{width:d+4,height:i,itemsPerPage:e}},_getVirtualItemsCount:function(){if(this.virtualItemsCount==0){var b=parseInt(this.host.height())/5;if(b>this.items.length){b=this.items.length}return b}else{return this.virtualItemsCount}},_addItems:function(){if(this.items==undefined||this.items.length==0){this.virtualSize={width:0,height:0,itemsPerPage:0};this._updatescrollbars();this.renderedVisibleItems=new Array();if(this.itemswrapper){this.itemswrapper.children().remove()}return}var l=this;var g=0;this.visibleItems=new Array();this.renderedVisibleItems=new Array();this.content.find(".jqx-listitem-state-normal").remove();this.content.find(".jqx-listitem-state-pressed").remove();this.content.find(".jqx-listitem-state-hover").remove();this.content.find(".jqx-listitem-state-disabled").remove();this.content.find(".jqx-listitem-state-group ").remove();this._removeHandlers();this.content[0].innerHTML="";this.itemswrapper=a('<div tabIndex=0 style="outline: 0 none; overflow:hidden; width:100%; position: relative;"></div>');this.itemswrapper.height(2*this.host.height());this.content.append(this.itemswrapper);var h=this._calculateVirtualSize();var i=h.itemsPerPage*2;if(this.autoHeight){i=this.items.length}this.virtualItemsCount=Math.min(i,this.items.length);var f=this;var e=h.width;this.virtualSize=h;this.itemswrapper.width(Math.max(this.host.width(),17+h.width));for(virtualItemIndex=0;virtualItemIndex<this.virtualItemsCount;virtualItemIndex++){var k=this.items[virtualItemIndex];var b=a("<div style='border: none; tabIndex=0 width:100%; height: 100%; align:left; valign:top; position: absolute;'></div>");var c=a("<span id='spanElement'></span>");b[0].id=l._createID();c.appendTo(b);b.appendTo(this.itemswrapper);if(this.checkboxes&&this.host.jqxCheckBox){var d=a('<div tabIndex=1 style="background-color: transparent; padding: 0; margin: 0; position: absolute; float: left; width: 16px; height: 16px;" class="chkbox"/>');b.css("float","left");c.css("float","left");b.prepend(d);d.jqxCheckBox({checked:k.checked,animationShowDelay:0,animationHideDelay:0,disabled:k.disabled,hasThreeStates:this.hasThreeStates,theme:this.theme});k.checkBoxElement=d[0];this.addHandler(d,"change",function(o){var m=o.owner.element.item;if(m!=null){var n=o.args;if(n.checked){f.checkIndex(m.index,false)}else{if(n.checked==false){f.uncheckIndex(m.index,false)}else{f.indeterminate(m.index,false)}}}f.focused=true})}b.height(k.height);b.css("top",g);g+=k.height;this.visualItems[virtualItemIndex]=b}this._addHandlers();this._updatescrollbars()},_updatescrollbars:function(){this._arrange();var e=this.virtualSize.height;var c=this.virtualSize.width;var b=this.vScrollInstance;var d=this.hScrollInstance;if(e>this.host.outerHeight()){var f=0;if(c>this.host.outerWidth()){f=this.hScrollBar.outerHeight()+2}b.max=2+parseInt(e)+f-parseInt(this.host.height());this.vScrollBar.css("visibility","visible")}else{this.vScrollBar.css("visibility","hidden")}if(c>this.host.outerWidth()){d.max=parseInt(c)-parseInt(this.content.width())+parseInt(this.hScrollBar.height());this.hScrollBar.css("visibility","visible")}else{this.hScrollBar.css("visibility","hidden")}this.hScrollBar.jqxScrollBar("setPosition",0);this._arrange();if(this.itemswrapper){this.itemswrapper.width(Math.max(this.host.width(),17+c));this.itemswrapper.height(2*this.host.height())}},clearSelection:function(b){for(indx=0;indx<this.selectedIndexes.length;indx++){this.selectedIndexes[indx]=-1}this.selectedIndex=-1;if(b==undefined||b==true){this._renderItems()}},unselectIndex:function(b,c){if(isNaN(b)){return}this.selectedIndexes[b]=-1;if(c==undefined||c==true){this._renderItems();this._raiseEvent("1",{index:b,type:type})}this._raiseEvent("2",{index:b,item:this.getItem(b)})},getItem:function(c){if(c==-1||isNaN(c)){return null}var b=null;var d=a.each(this.items,function(){if(this.index==c){b=this;return false}});return b},checkIndex:function(b,c){if(!this.checkboxes||!this.host.jqxCheckBox){return}if(isNaN(b)){return}if(b<0||b>=this.visibleItems.length){return}if(this.visibleItems[b]!=null&&this.visibleItems[b].disabled){return}if(this.disabled){return}var d=this.getItem(b);if(d!=null){var e=a(d.checkBoxElement);d.checked=true;if(c==undefined||c==true){this._renderItems()}}this._raiseEvent(3,{label:d.label,value:d.value,checked:true})},checkAll:function(){if(!this.checkboxes||!this.host.jqxCheckBox){return}if(this.disabled){return}a.each(this.items,function(){this.checked=true});this._renderItems();this._raiseEvent(3,{checked:true})},uncheckAll:function(){if(!this.checkboxes||!this.host.jqxCheckBox){return}if(this.disabled){return}a.each(this.items,function(){this.checked=false});this._renderItems();this._raiseEvent(3,{checked:false})},uncheckIndex:function(b,c){if(!this.checkboxes||!this.host.jqxCheckBox){return}if(isNaN(b)){return}if(b<0||b>=this.visibleItems.length){return}if(this.visibleItems[b]!=null&&this.visibleItems[b].disabled){return}if(this.disabled){return}var d=this.getItem(b);if(d!=null){var e=a(d.checkBoxElement);d.checked=false;if(c==undefined||c==true){this._renderItems()}}this._raiseEvent(3,{label:d.label,value:d.value,checked:false})},indeterminateIndex:function(b,c){if(!this.checkboxes||!this.host.jqxCheckBox){return}if(isNaN(b)){return}if(b<0||b>=this.visibleItems.length){return}if(this.visibleItems[b]!=null&&this.visibleItems[b].disabled){return}if(this.disabled){return}var d=this.getItem(b);if(d!=null){var e=a(d.checkBoxElement);d.checked=null;if(c==undefined||c==true){this._renderItems()}}this._raiseEvent(3,{checked:null})},getSelectedIndex:function(){return this.selectedIndex},getSelectedItem:function(){return this.getItem(this.selectedIndex)},selectIndex:function(c,e,g,d,f){if(isNaN(c)){return}if(c<-1||c>=this.visibleItems.length){return}if(this.visibleItems[c]!=null&&this.visibleItems[c].disabled){return}if(this.disabled){return}if(!this.multiple&&this.selectedIndex==c){return}this.focused=true;var b=false;if(this.selectedIndex!=c){b=true}var h=this.selectedIndex;if(this.selectedIndex==c&&!this.multiple){h=-1}if(f==undefined){f="none"}if(d!=undefined&&d){this._raiseEvent("1",{index:h,type:f});this.selectedIndex=c;this.selectedIndexes[h]=-1;this.selectedIndexes[c]=c;this._raiseEvent("0",{index:c,type:f})}else{if(this.multiple){if(this.selectedIndexes[c]==undefined||this.selectedIndexes[c]==-1){this.selectedIndexes[c]=c;this.selectedIndex=c;this._raiseEvent("0",{index:c,type:f})}else{h=this.selectedIndexes[c];this.selectedIndexes[c]=-1;this.selectedIndex=-1;this._raiseEvent("1",{index:h,type:f})}}else{this._raiseEvent("1",{index:h,type:f});this.selectedIndex=c;this.selectedIndexes[h]=-1;h=c;this.selectedIndexes[c]=c;this._raiseEvent("0",{index:c,type:f})}}if(g==undefined||g==true){this._renderItems()}if(e!=undefined&&e!=null&&e==true){this.ensureVisible(c)}this._raiseEvent("2",{index:c,item:this.getItem(c)});return b},isIndexInView:function(c){if(isNaN(c)){return false}if(c<0||c>=this.items.length){return false}var d=this.vScrollInstance.value;var b=this.visibleItems[this.selectedIndex].initialTop;if(b-d<0||b-d>=this.host.outerHeight()){return false}return true},_itemsInPage:function(){var b=0;var c=this;a.each(this.items,function(){if((this.initialTop+this.height)>=c.content.height()){return false}b++});return b},_firstItemIndex:function(){if(this.visibleItems!=null){if(this.visibleItems[0].isGroup){return this._nextItemIndex(0)}else{return 0}}return -1},_lastItemIndex:function(){if(this.visibleItems!=null){if(this.visibleItems[this.visibleItems.length-1].isGroup){return this._prevItemIndex(this.visibleItems.length-1)}else{return this.visibleItems.length-1}}return -1},_nextItemIndex:function(b){for(indx=b+1;indx<this.visibleItems.length;indx++){if(!this.visibleItems[indx].disabled&&!this.visibleItems[indx].isGroup){return indx}}return -1},_prevItemIndex:function(b){for(indx=b-1;indx>=0;indx--){if(!this.visibleItems[indx].disabled&&!this.visibleItems[indx].isGroup){return indx}}return -1},_handleKeyDown:function(b){var k=b.keyCode;var l=this;var g=l.selectedIndex;var c=l.selectedIndex;var h=false;if(b.altKey){k=-1}if(k==33){var f=l._itemsInPage();if(l.selectedIndex-f>=0){if(l.multiple){l.clearSelection(false)}l.selectIndex(c-f,false,false,false,"keyboard")}else{if(l.multiple){l.clearSelection(false)}l.selectIndex(l._firstItemIndex(),false,false,false,"keyboard")}}if(k==32&&this.checkboxes){var e=this.getItem(g);if(e!=null){if(e.checked==true){e.checked=this.hasThreeStates?null:false}else{e.checked=e.checked!=null}switch(e.checked){case true:this.checkIndex(g);break;case false:this.uncheckIndex(g);break;default:this.indeterminateIndex(g);break}}}if(k==36){if(l.multiple){l.clearSelection(false)}l.selectIndex(l._firstItemIndex(),false,false,false,"keyboard")}if(k==35){if(l.multiple){l.clearSelection(false)}l.selectIndex(l._lastItemIndex(),false,false,false,"keyboard")}if(k==34){var f=l._itemsInPage();if(l.selectedIndex+f<l.visibleItems.length){if(l.multiple){l.clearSelection(false)}l.selectIndex(c+f,false,false,false,"keyboard")}else{if(l.multiple){l.clearSelection(false)}l.selectIndex(l._lastItemIndex(),false,false,false,"keyboard")}}if(k==38){if(l.selectedIndex>0){var i=l._prevItemIndex(l.selectedIndex);if(i!=l.selectedIndex&&i!=-1){if(l.multiple){l.clearSelection(false)}l.selectIndex(i,false,false,false,"keyboard")}else{return true}}else{return false}}else{if(k==40){if(l.selectedIndex+1<l.visibleItems.length){var i=l._nextItemIndex(l.selectedIndex);if(i!=l.selectedIndex&&i!=-1){if(l.multiple){l.clearSelection(false)}l.selectIndex(i,false,false,false,"keyboard")}else{return true}}else{return false}}}if(k==35||k==36||k==38||k==40||k==34||k==33){var d=l.isIndexInView(l.selectedIndex);if(!d){l.ensureVisible(l.selectedIndex)}else{l._renderItems()}return false}return true},wheel:function(d,c){var e=0;if(!d){d=window.event}if(d.originalEvent&&d.originalEvent.wheelDelta){d.wheelDelta=d.originalEvent.wheelDelta}if(d.wheelDelta){e=d.wheelDelta/120}else{if(d.detail){e=-d.detail/3}}if(e){var b=c._handleDelta(e);if(d.preventDefault){d.preventDefault()}if(!b){return b}else{return false}}if(d.preventDefault){d.preventDefault()}d.returnValue=false},_handleDelta:function(d){if(this.focused){var c=this.vScrollInstance.value;if(d<0){this.scrollDown()}else{this.scrollUp()}var b=this.vScrollInstance.value;if(c!=b){return false}}return true},_removeHandlers:function(){var b=this;this.removeHandler(this.vScrollBar,"valuechanged");this.removeHandler(this.hScrollBar,"valuechanged");this.removeHandler(this.host,"mousewheel");this.removeHandler(this.content,"keydown");this.removeHandler(this.content,"mouseleave");this.removeHandler(this.content,"focus");this.removeHandler(this.content,"blur");this.removeHandler(this.content,"mouseenter");this.removeHandler(this.content,"mouseup");this.removeHandler(this.content,"mousedown");this.removeHandler(this.content,"mousemove");if(a.browser.msie){this.removeHandler(this.content,"selectstart")}},_addHandlers:function(){var c=this;this.focused=false;var b=false;var h=0;var e=null;var h=0;var g=0;var f=new Date();var d=this.isTouchDevice();if((this.width!=null&&this.width.toString().indexOf("%")!=-1)||(this.height!=null&&this.height.toString().indexOf("%")!=-1)){this.autoUpdateId=setInterval(function(){if(c.host.height()!=c._oldheight||c.host.width()!=c._oldwidth){c._oldwidth=c.host.width();c._oldheight=c.host.height();if(c.items){if(c.items.length>0&&c.virtualItemsCount*c.items[0].height<c._oldheight){c._render(false)}else{c._updatescrollbars();c._renderItems()}}}},100)}this.addHandler(this.vScrollBar,"valuechanged",function(i){c._renderItems()});this.addHandler(this.hScrollBar,"valuechanged",function(){c._renderItems()});this.addHandler(this.host,"mousewheel",function(i){c.wheel(i,c)});this.addHandler(this.content,"keydown",function(i){if(c.focused){return c._handleKeyDown(i)}});this.addHandler(this.content,"mouseleave",function(i){c.focused=false;var k=a.data(c.element,"hoveredItem");if(k!=null){a(k).removeClass(c.toThemeProperty("jqx-listitem-state-hover"))}});this.addHandler(this.content,"focus",function(i){c.focused=true});this.addHandler(this.content,"blur",function(i){c.focused=false});this.addHandler(this.content,"mouseenter",function(i){c.focused=true});if(this.enableSelection){this.addHandler(this.content,"mousedown",function(m){if(m.target.id!="listBoxContent"&&c.itemswrapper[0]!=m.target){c.focused=true;if(!c.isTouchDevice()){c.content.focus()}var n=m.target;var o=a(n).offset();var k=c.host.offset();var p=parseInt(o.top)-parseInt(k.top);var i=parseInt(o.left)-parseInt(k.left);var l=c._hitTest(i,p);if(l!=null&&!l.isGroup){if(l.html.indexOf("href")!=-1){setTimeout(function(){c.selectIndex(l.visibleIndex,false,true,false,"mouse")},100)}else{c.selectIndex(l.visibleIndex,false,true,false,"mouse")}}}});this.addHandler(this.content,"mouseup",function(i){c.vScrollInstance.handlemouseup(c,i)});if(a.browser.msie){this.addHandler(this.content,"selectstart",function(i){return false})}}var d=this.isTouchDevice();if(this.enableHover&&!d){this.addHandler(this.content,"mousemove",function(i){if(d){return true}if(!c.enableHover){return true}var k=a.browser.msie==true&&a.browser.version<9?0:1;if(i.target==null){return true}if(c.disabled){return true}c.focused=true;var m=c.vScrollInstance.isScrolling();if(!m&&i.target.id!="listBoxContent"){if(c.itemswrapper[0]!=i.target){var o=i.target;var t=a(o).offset();var n=c.host.offset();var p=parseInt(t.top)-parseInt(n.top);var q=parseInt(t.left)-parseInt(n.left);var s=c._hitTest(q,p);if(s!=null&&!s.isGroup&&!s.disabled){var l=a.data(c.element,"hoveredItem");if(l!=null){a(l).removeClass(c.toThemeProperty("jqx-listitem-state-hover"))}a.data(c.element,"hoveredItem",s.element);var r=a(s.element);r.addClass(c.toThemeProperty("jqx-listitem-state-hover"))}}}})}},_arrange:function(){var c=null;var i=null;if(this.width!=null&&this.width.toString().indexOf("px")!=-1){c=this.width}else{if(this.width!=undefined&&!isNaN(this.width)){c=this.width}}if(this.height!=null&&this.height.toString().indexOf("px")!=-1){i=this.height}else{if(this.height!=undefined&&!isNaN(this.height)){i=this.height}}if(this.width!=null&&this.width.toString().indexOf("%")!=-1){this.host.width(this.width);c=this.host.width()}if(this.height!=null&&this.height.toString().indexOf("%")!=-1){this.host.height(this.height);i=this.host.height()}var h=this.host.css("border-width");if(h==null){h=0}if(c!=null){c=parseInt(c);this.host.width(this.width)}if(!this.autoHeight){if(i!=null){i=parseInt(i);this.host.height(this.height)}}else{this.host.height(this.virtualSize.height);this.height=this.virtualSize.height}var b=this.scrollBarSize;if(isNaN(b)){b=parseInt(b);if(isNaN(b)){b="17px"}else{b=b+"px"}}b=parseInt(b);var f=4;var k=2;var g=0;if(this.vScrollBar){if(this.vScrollBar.css("visibility")=="visible"){g=b+f}else{this.vScrollBar.jqxScrollBar("setPosition",0)}}else{return}if(this.hScrollBar){if(this.hScrollBar.css("visibility")=="visible"){k=b+f}else{this.hScrollBar.jqxScrollBar("setPosition",0)}}else{return}this.hScrollBar.height(b);this.hScrollBar.css({top:i-f-b+"px",left:"0px"});this.hScrollBar.width(c-b-f+"px");if(g==0){this.hScrollBar.width(c-2)}this.vScrollBar.width(b);this.vScrollBar.height(parseInt(i)-k+"px");this.vScrollBar.css({left:parseInt(c)-parseInt(b)-f+"px",top:"0px"});var e=this.vScrollInstance;e.disabled=this.disabled;e._arrange();var d=this.hScrollInstance;d.disabled=this.disabled;d._arrange();if((this.vScrollBar.css("visibility")=="visible")&&(this.hScrollBar.css("visibility")=="visible")){this.bottomRight.css("visibility","visible");this.bottomRight.css({left:1+parseInt(this.vScrollBar.css("left")),top:1+parseInt(this.hScrollBar.css("top"))});this.bottomRight.width(parseInt(b)+3);this.bottomRight.height(parseInt(b)+3)}else{this.bottomRight.css("visibility","hidden")}this.content.width(c-g);this.content.height(i-k)},ensureVisible:function(c){if(c<0){return}if(this.autoHeight){var b=a.data(this.vScrollBar[0],"jqxScrollBar").instance;b.setPosition(0)}else{for(indx=0;indx<this.visibleItems.length;indx++){var d=this.visibleItems[indx];if(d.visibleIndex==c&&!d.isGroup){var b=a.data(this.vScrollBar[0],"jqxScrollBar").instance;b.setPosition(d.initialTop);break}}}this._renderItems()},scrollDown:function(){if(this.vScrollBar.css("visibility")=="hidden"){return}var b=this.vScrollInstance;if(b.value+b.largestep<=b.max){b.setPosition(b.value+b.largestep)}else{b.setPosition(b.max)}},scrollUp:function(){if(this.vScrollBar.css("visibility")=="hidden"){return}var b=this.vScrollInstance;if(b.value-b.largestep>=b.min){b.setPosition(b.value-b.largestep)}else{b.setPosition(b.min)}},loadItems:function(h){if(h==null){this.groups=new Array();this.items=new Array();this.visualItems=new Array();return}var n=this;var f=0;var d=0;var b=0;this.groups=new Array();this.items=new Array();this.visualItems=new Array();var e=new Array();a.map(h,function(s){if(s==undefined){return null}var p=new a.jqx._jqxListBox.item();var t=s.group;var o=s.groupHtml;var u=s.title;if(u==null||u==undefined){u=""}if(t==null||t==undefined){t=""}if(o==null||o==undefined){o=""}if(!n.groups[t]){n.groups[t]={items:new Array(),index:-1,caption:t,captionHtml:o};f++;var q=f+"jqxGroup";n.groups[q]=n.groups[t];d++}var r=n.groups[t];r.index++;r.items[r.index]=p;if(typeof s==="string"){p.label=s;p.value=s}else{if(s.label==null&&s.value==null&&s.html==null&&s.group==null&&s.groupHtml==null){p.label=s.toString();p.value=s.toString()}else{p.label=s.label||s.value;p.value=s.value||s.label}}p.originalItem=s;p.title=u;p.html=s.html||"";p.group=t;p.groupHtml=s.groupHtml||"";p.disabled=s.disabled||false;p.visible=s.visible||true;p.index=b;e[b]=p;b++;return p});var c=new Array();var k=0;if(this.fromSelect==undefined||this.fromSelect==false){for(indx=0;indx<d;indx++){var f=indx+1;var i=f+"jqxGroup";var l=this.groups[i];if(l==undefined||l==null){break}if(indx==0&&l.caption==""&&l.captionHtml==""&&d<=1){return l.items}else{var g=new a.jqx._jqxListBox.item();g.isGroup=true;g.label=l.caption;if(l.caption==""&&l.captionHtml==""){l.caption=this.emptyGroupText;g.label=l.caption}g.html=l.captionHtml;c[k]=g;k++}for(j=0;j<l.items.length;j++){c[k]=l.items[j];k++}}}else{var k=0;var m=new Array();a.each(e,function(){if(!m[this.group]){if(this.group!=""){var o=new a.jqx._jqxListBox.item();o.isGroup=true;o.label=this.group;c[k]=o;k++;m[this.group]=true}}c[k]=this;k++})}return c},_mapItem:function(c){var b=new a.jqx._jqxListBox.item();if(typeof c==="string"){b.label=c;b.value=c}else{if(typeof c==="number"){b.label=c.toString();b.value=c.toString()}else{b.label=c.label||c.value;b.value=c.value||c.label}}b.html=c.html||"";b.group=c.group||"";b.groupHtml=c.groupHtml||"";b.disabled=c.disabled||false;b.visible=c.visible||true;return b},addItem:function(b){if(this.items==undefined||this.items.length==0){this.source=new Array();this.source[0]=b;this.refresh();return}return this.insertAt(b,this.items.length)},insertAt:function(i,e){if(i==null){return false}if(this.items==undefined||this.items.length==0){this.source=new Array();this.source[0]=i;this.refresh();return false}var d=this._mapItem(i);if(e==-1||e==undefined||e==null||e>=this.items.length){d.index=this.items.length;this.items[this.items.length]=d}else{var f=new Array();var h=0;var g=false;var b=0;for(itemIndex=0;itemIndex<this.items.length;itemIndex++){if(this.items[itemIndex].isGroup==false){if(b>=e&&!g){f[h++]=d;d.index=e;b++;g=true}}f[h]=this.items[itemIndex];if(!this.items[itemIndex].isGroup){f[h].index=b;b++}h++}this.items=f}this.visibleItems=new Array();var c=a.data(this.vScrollBar[0],"jqxScrollBar").instance;c.setPosition(0);this._addItems();this._renderItems();return true},removeAt:function(c){if(c<0||c>this.items.length-1){return false}this.items.splice(c,1);var b=a.data(this.vScrollBar[0],"jqxScrollBar").instance;b.setPosition(0);this.visibleItems=new Array();this._addItems();this._renderItems();return true},getItems:function(){return this.items},disableAt:function(b){if(!this.items){return false}if(b<0||b>this.items.length-1){return false}this.items[b].disabled=true;this._renderItems();return true},enableAt:function(b){if(!this.items){return false}if(b<0||b>this.items.length-1){return false}this.items[b].disabled=false;this._renderItems();return true},destroy:function(){this._removeHandlers();this.vScrollBar.jqxScrollBar("destroy");this.hScrollBar.jqxScrollBar("destroy");this.vScrollBar.remove();this.hScrollBar.remove();this.host.removeClass("jqx-listbox jqx-rc-all");this.host.remove()},_raiseEvent:function(f,c){if(c==undefined){c={owner:null}}var d=this.events[f];args=c;args.owner=this;var e=new jQuery.Event(d);e.owner=this;if(f==0||f==1||f==2||f==3){e.args=args}var b=this.host.trigger(e);return b}})})(jQuery);(function(a){a.jqx._jqxListBox.item=function(){var b={group:"",groupHtml:"",selected:false,isGroup:false,highlighted:false,value:null,label:"",html:null,visible:true,disabled:false,element:null,width:null,height:null,initialTop:null,top:null,left:null,title:"",index:-1,checkBoxElement:null,originalItem:null,checked:false,visibleIndex:-1};return b}})(jQuery);