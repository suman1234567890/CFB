/*
Copyright (c) 2012 jqWidgets.
http://jqwidgets.com/license/
*/

(function(a){a.extend(a.jqx._jqxGrid.prototype,{setcolumnfilterable:function(b,c){this._setcolumnproperty(b,"filterable",text)},getcolumnfilterable:function(b){return this._getcolumnproperty(b,"filterable")},_renderfiltercolumn:function(){var b=this;if(this.filterable){a.each(this.columns.records,function(c,d){if(b.autoshowfiltericon){if(this.filter){a(this.filtericon).show()}else{a(this.filtericon).hide()}}else{a(this.filtericon).show()}})}},_getcolumntypebydatafield:function(d){var e=this;var c="string";if(e.source.datafields){a.each(e.source.datafields,function(){if(this.name==d.datafield){if(this.type){c=this.type}return false}})}else{if(d!=null){if(this.dataview.cachedrecords.length==0){return}var b=this.dataview.cachedrecords[0][d.datafield];if(b!=null){if(a.jqx.dataFormat.isNumber(b)){c="number"}else{var f=new Date(b);if(f.toString()=="NaN"||f.toString()=="Invalid Date"){if(a.jqx.gridformat){f=a.jqx.gridformat.tryparsedate(b);if(f!=null){return"date"}else{c="string"}}else{c="string"}}else{c="date"}}}}}return c},_getfiltersbytype:function(b){var c=this;var d="";switch(b){case"number":case"float":case"int":d=c.gridlocalization.filternumericcomparisonoperators;break;case"date":d=c.gridlocalization.filterdatecomparisonoperators;break;case"string":default:d=c.gridlocalization.filterstringcomparisonoperators;break}return d},_updatefilterpanel:function(x,b,c){if(x==null||x==undefined){x=this}var d=x._getcolumntypebydatafield(c);var s=x._getfiltersbytype(d);if(!x.host.jqxDropDownList){alert("jqxdropdownlist is not loaded.");return}var n=a(b).find("#filterclearbutton"+x.element.id);var g=a(b).find("#filterbutton"+x.element.id);var u=a(b).find("#filter1"+x.element.id);var r=a(b).find("#filter2"+x.element.id);var t=a(b).find("#filter3"+x.element.id);var q=a(b).find(".filtertext1"+x.element.id);var p=a(b).find(".filtertext2"+x.element.id);q.val("");p.val("");this.removeHandler(g,"click");this.addHandler(g,"click",function(){x._buildfilter(x,b,c);x._closemenu()});this.removeHandler(n,"click");this.addHandler(n,"click",function(){x._clearfilter(x,b,c);x._closemenu()});u.jqxDropDownList({source:s});t.jqxDropDownList({source:s});u.jqxDropDownList({selectedIndex:2});t.jqxDropDownList({selectedIndex:2});var l=c.filter;if(l!=null){var w=l.getfilterat(0);var v=l.getfilterat(1);var k=l.getoperatorat(0);var h=[];switch(d){case"number":h=l.getoperatorsbyfiltertype("numericfilter");break;case"date":h=l.getoperatorsbyfiltertype("datefilter");break;case"string":h=l.getoperatorsbyfiltertype("stringfilter");break}var j=this.enableanimations?"default":"none";if(w!=null){var f=h.indexOf(w.comparisonoperator);var o=w.filtervalue;q.val(o);u.jqxDropDownList({selectedIndex:f,animationType:j})}if(v!=null){var e=h.indexOf(v.comparisonoperator);var m=v.filtervalue;p.val(m);t.jqxDropDownList({selectedIndex:e,animationType:j})}if(l.getoperatorat(0)==undefined){r.jqxDropDownList({selectedIndex:0,animationType:j})}else{if(l.getoperatorat(0)=="and"||l.getoperatorat(0)==0){r.jqxDropDownList({selectedIndex:0})}else{r.jqxDropDownList({selectedIndex:1})}}}},_buildfilter:function(B,d,e){var y=a(d).find("#filter1"+B.element.id);var k=a(d).find("#filter2"+B.element.id);var v=a(d).find("#filter3"+B.element.id);var r=a(d).find(".filtertext1"+B.element.id);var q=a(d).find(".filtertext2"+B.element.id);var p=r.val();var n=q.val();var f=B._getcolumntypebydatafield(e);var s=B._getfiltersbytype(f);var h=y.jqxDropDownList("selectedIndex");var x=k.jqxDropDownList("selectedIndex");var g=v.jqxDropDownList("selectedIndex");var j=new a.jqx.filter();var A=null;var z=null;var c="";switch(f){case"number":case"float":case"int":c="numericfilter";break;case"date":c="datefilter";break;case"string":c="stringfilter";break}var b=false;var w=j.getoperatorsbyfiltertype(c)[h];var v=j.getoperatorsbyfiltertype(c)[g];var o=w=="NULL"||w=="NOT_NULL";var u=w=="EMPTY"||w=="NOT_EMPTY";if(p.length>0||o||u){A=j.createfilter(c,p,w);j.addfilter(x,A);b=true}var m=v=="NULL"||v=="NOT_NULL";var t=v=="EMPTY"||v=="NOT_EMPTY";if(n.length>0||m||t){z=j.createfilter(c,n,v);j.addfilter(x,z);b=true}if(b){var l=e.datafield;this.addfilter(l,j,true)}},_clearfilter:function(e,c,d){var b=d.datafield;this.removefilter(b,true)},addfilter:function(d,e,c){if(this._loading){alert(this.loadingerrormessage);return false}var f=this.getcolumn(d);var b=this._getcolumn(d);if(f==undefined||f==null){return}f.filter=e;b.filter=e;this.dataview.addfilter(d,e);if(c==true&&c!=undefined){this.applyfilters()}},removefilter:function(d,c){if(this._loading){alert(this.loadingerrormessage);return false}var e=this.getcolumn(d);var b=this._getcolumn(d);if(e==undefined||e==null){return}if(e.filter==null){return}this.dataview.removefilter(d,e.filter);e.filter=null;b.filter=null;if(c==true||c!=undefined){this.applyfilters()}},applyfilters:function(){var b=false;if(this.dataview.filters.length>=0){if(this.source!=null&&this.source.filter){this.source.filter(this.dataview.filters);b=true}}if(!this.virtualmode){this.dataview.refresh()}else{this._raiseEvent(13,{filters:this.dataview.filters});return}if(this.pageable){this.dataview.updateview();this.gotopage(0)}this._updaterowsproperties();if(!this.groupable){this._render(true,true,false);this._updatecolumnwidths();this._updatecellwidths()}else{this.render()}this._raiseEvent(13,{filters:this.dataview.filters})},getfilterinformation:function(){var c=new Array();for(i=0;i<this.dataview.filters.length;i++){var b=this.getcolumn(this.dataview.filters[i].datafield);c[i]={filter:this.dataview.filters[i].filter,filtercolumn:b.datafield,filtercolumntext:b.text}}return c},clearfilters:function(){var b=this;if(this.columns.records){a.each(this.columns.records,function(){b.removefilter(this.datafield)})}this.applyfilters()},_initfilterpanel:function(s,b,c,l){if(s==null||s==undefined){s=this}b[0].innerHTML="";var p=a("<div class='filter' style='margin-left: 7px;'></div>");b.append(p);var k=a("<div class='filter' style='margin-top: 3px; margin-bottom: 3px;'></div>");k.text(s.gridlocalization.filtershowrowstring);var q=a("<div class='filter' id='filter1"+s.element.id+"'></div>");var g=a("<div class='filter' id='filter2"+s.element.id+"' style='margin-bottom: 3px;'></div>");var o=a("<div class='filter' id='filter3"+s.element.id+"'></div>");var d=s._getcolumntypebydatafield(c);if(!q.jqxDropDownList){alert("jqxdropdownlist is not loaded.");return}var m=s._getfiltersbytype(d);var h=a("<div class='filter'><input class='filtertext1"+s.element.id+"' style='height: 20px; margin-top: 3px; margin-bottom: 3px;' type='text'></input></div>");h.find("input").addClass(this.toThemeProperty("jqx-input"));h.find("input").addClass(this.toThemeProperty("jqx-rc-all"));h.find("input").width(l-15);var j=a("<div class='filter'><input class='filtertext2"+s.element.id+"' style='height: 20px; margin-top: 3px;' type='text'></input></div>");j.find("input").addClass(this.toThemeProperty("jqx-input"));j.find("input").addClass(this.toThemeProperty("jqx-rc-all"));j.find("input").width(l-15);var f=a("<div class='filter' style='height: 25px; margin-left: 20px; margin-top: 7px;'></div>");var e=a('<span id="filterbutton'+s.element.id+'" class="filterbutton" style="padding: 4px 12px; margin-left: 2px;">'+s.gridlocalization.filterstring+"</span>");f.append(e);var r=a('<span id="filterclearbutton'+s.element.id+'" class="filterclearbutton" style="padding: 4px 12px; margin-left: 5px;">'+s.gridlocalization.filterclearstring+"</span>");f.append(r);e.jqxButton({height:20,theme:s.theme});r.jqxButton({height:20,theme:s.theme});var t=function(v){if(v.text().indexOf("case sensitive")!=-1){var u=v.text();u=u.replace("case sensitive","match case");v.text(u)}v.css("font-family",s.host.css("font-family"));v.css("font-size",s.host.css("font-size"));return v};p.append(k);p.append(q);q.jqxDropDownList({selectedIndex:2,width:l-15,height:20,dropDownHeight:150,dropDownWidth:l-15,selectionRenderer:t,source:m,theme:s.theme});p.append(h);var n=new Array();n[0]=s.gridlocalization.filterandconditionstring;n[1]=s.gridlocalization.filterorconditionstring;g.jqxDropDownList({autoDropDownHeight:true,selectedIndex:0,width:60,height:20,source:n,selectionRenderer:t,theme:s.theme});p.append(g);o.jqxDropDownList({selectedIndex:2,width:l-15,height:20,dropDownHeight:150,dropDownWidth:l-15,selectionRenderer:t,source:m,theme:s.theme});p.append(o);p.append(j);p.append(f)}});a.jqx.filter=function(){this.operator="and";var f=0;var d=1;var h=["EMPTY","NOT_EMPTY","CONTAINS","CONTAINS_CASE_SENSITIVE","DOES_NOT_CONTAIN","DOES_NOT_CONTAIN_CASE_SENSITIVE","STARTS_WITH","STARTS_WITH_CASE_SENSITIVE","ENDS_WITH","ENDS_WITH_CASE_SENSITIVE","EQUAL","EQUAL_CASE_SENSITIVE","NULL","NOT_NULL"];var l=["EQUAL","NOT_EQUAL","LESS_THAN","LESS_THAN_OR_EQUAL","GREATER_THAN","GREATER_THAN_OR_EQUAL","NULL","NOT_NULL"];var m=["EQUAL","NOT_EQUAL","LESS_THAN","LESS_THAN_OR_EQUAL","GREATER_THAN","GREATER_THAN_OR_EQUAL","NULL","NOT_NULL"];var e=new Array();var k=new Array();this.evaluate=function(q){var p=true;for(i=0;i<e.length;i++){var o=e[i].evaluate(q);if(i==0){p=o}else{if(k[i]==d||k[i]=="or"){p=p||o}else{p=p&&o}}}return p};this.getfilterscount=function(){return e.length};this.getoperatorsbyfiltertype=function(o){var p=new Array();switch(o){case"numericfilter":p=l.slice(0);break;case"stringfilter":p=h.slice(0);break;case"datefilter":p=m.slice(0);break}return p};var j=function(){var o=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(o()+"-"+o()+"-"+o())};this.createfilter=function(r,o,q,p){if(r==null||r==undefined){return null}switch(r){case"numericfilter":return new g(o,q.toUpperCase());case"stringfilter":return new n(o,q.toUpperCase());case"datefilter":return new c(o,q.toUpperCase());case"custom":return new b(o,q.toUpperCase(),p)}return null};this.getfilters=function(){var o=new Array();for(i=0;i<e.length;i++){var p={value:e[i].filtervalue,condition:e[i].comparisonoperator,operator:k[i]};o[i]=p}return o};this.addfilter=function(o,p){e[e.length]=p;p.key=j();k[k.length]=o};this.removefilter=function(o){for(i=0;i<e.length;i++){if(e[i].key==o.key){e.splice(i,1);k.splice(i,1);break}}};this.getoperatorat=function(o){if(o==undefined||o==null){return null}if(o<0||o>e.length){return null}return k[o]};this.setoperatorat=function(p,o){if(p==undefined||p==null){return null}if(p<0||p>e.length){return null}k[o]=o};this.getfilterat=function(o){if(o==undefined||o==null){return null}if(o<0||o>e.length){return null}return e[o]};this.setfilterat=function(o,p){if(o==undefined||o==null){return null}if(o<0||o>e.length){return null}p.key=j();e[o]=p};this.clear=function(){e=new Array();k=new Array()};var n=function(p,o){this.filtervalue=p;this.comparisonoperator=o;this.evaluate=function(t){var s=this.filtervalue;var q=this.comparisonoperator;if(t==null||t==undefined){if(q=="NULL"){return true}return false}var u="";try{u=t.toString()}catch(r){return true}switch(q){case"EQUAL":return a.jqx.string.equalsIgnoreCase(u,s);case"EQUAL_CASE_SENSITIVE":return a.jqx.string.equals(u,s);case"CONTAINS":return a.jqx.string.containsIgnoreCase(u,s);case"CONTAINS_CASE_SENSITIVE":return a.jqx.string.contains(u,s);case"DOES_NOT_CONTAIN":return !a.jqx.string.containsIgnoreCase(u,s);case"DOES_NOT_CONTAIN_CASE_SENSITIVE":return !a.jqx.string.contains(u,s);case"EMPTY":return u=="";case"NOT_EMPTY":return u!="";case"NOT_NULL":return u!=null;case"STARTS_WITH":return a.jqx.string.startsWithIgnoreCase(u,s);case"ENDS_WITH":return a.jqx.string.endsWithIgnoreCase(u,s);case"ENDS_WITH_CASE_SENSITIVE":return a.jqx.string.endsWith(u,s);case"STARTS_WITH_CASE_SENSITIVE":return a.jqx.string.startsWith(u,s);default:return false}}};var g=function(p,o){this.filtervalue=p;this.comparisonoperator=o;this.evaluate=function(t){var s=this.filtervalue;var q=this.comparisonoperator;if(t==null||t==undefined){if(q=="NOT_NULL"){return false}if(q=="NULL"){return true}else{return false}}else{if(q=="NULL"){return false}if(q=="NOT_NULL"){return true}}var u=t;try{u=parseFloat(u)}catch(r){if(t.toString()!=""){return false}}switch(q){case"EQUAL":return u==s;case"NOT_EQUAL":return u!=s;case"GREATER_THAN":return u>s;case"GREATER_THAN_OR_EQUAL":return u>=s;case"LESS_THAN":return u<s;case"LESS_THAN_OR_EQUAL":return u<=s;default:return true}}};var c=function(p,o){this.filtervalue=p;var q=new Date(p);if(q.toString()=="NaN"||q.toString()=="Invalid Date"){this.filterdate=a.jqx.gridformat.tryparsedate(p)}else{this.filterdate=q}this.comparisonoperator=o;this.evaluate=function(v){var t=this.filtervalue;var r=this.comparisonoperator;if(v==null||v==undefined){if(r=="NOT_NULL"){return false}if(r=="NULL"){return true}else{return false}}else{if(r=="NULL"){return false}if(r=="NOT_NULL"){return true}}var w=new Date();w.setFullYear(1900,0,1);w.setHours(12,0,0,0);try{var u=new Date(v);if(u.toString()=="NaN"||u.toString()=="Invalid Date"){v=a.jqx.gridformat.tryparsedate(v)}else{v=u}w=v}catch(s){if(v.toString()!=""){return false}}t=this.filterdate;switch(r){case"EQUAL":return w.toString()==t.toString();case"NOT_EQUAL":return w.toString()!=t.toString();case"GREATER_THAN":return w>t;case"GREATER_THAN_OR_EQUAL":return w>=t;case"LESS_THAN":return w<t;case"LESS_THAN_OR_EQUAL":return w<=t;default:return true}}};var b=function(p,o,q){this.filtervalue=p;this.comparisonoperator=o;this.evaluate=function(s,r){return q(this.filtervalue,s,this.comparisonoperator)}}}})(jQuery);